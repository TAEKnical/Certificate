# 볼륨, 스토리지

## S3 버킷

**버전 관리와 MFA Delete 활성화**

영구적 제거 대신 삭제 마커로 버전 관리

삭제한 객체 복구 가능

MFA Delete는 HTTPS 패킷에 x-amz-mfa 헤더 넣어 보내야 됨

안정성, 가용성, 무제한 확장, 저렴한 비용, 정적 웹 사이트 호스팅



## S3 Standard IA

백업용



## RDS

데이터베이스

Multi-AZ 구성을 해야만 내구성 확보



## EC2

EC2가 재시작되면 데이터도 사라짐



IOPS SSD(io1)

IOPS 성능이 지속적으로 요구되는 중요한 비즈니스에 사용



## EBS 볼륨

S3에 비해 내구성 떨어짐

정적 콘텐츠에 부적합



## HDD

**AWS 처리량 최적화 HDD(st1)**

부팅 볼륨으로 쓸 수 없음

처리량에 최적화된 HDD는 자주 액세스하는 처리량이 많은 워크로드에 사용

저렴



**Cold HDD(sc1)**

부팅 볼륨으로 쓸 수 없음

범용 SSD에 비해 저렴



## 범용 SSD

부팅 볼륨으로 사용 가능

트랜잭션 데이터베이스 워크로드에 적합

광범위한 작업에서 이상적(웬만하면 답)







---



# 로깅

## CloudWatch

- Amazon CloudWatch는 Amazon Web Services(AWS) 리소스와 AWS에서 실시간으로 실행 중인 애플리케이션을 모니터링

- 알림, 경고기능
-  Amazon CloudWatch는 AWS 리소스를 위한 모니터링 도구 



## CloudTrail

- AWS CloudTrail은 AWS 계정의 거버넌스, 규정 준수, 운영 감사, 위험 감사를 지원하는 서비스
-  계정 활동과 관련된 작업을 기록 

-  Amazon CloudWatch Logs와의 통합을 통해 간편하게 로그 데이터를 검색하고, 규정 위반 이벤트를 파악하며, 인시던트 조사를 가속화하고, 감사관 요청에 신속히 응답 



# 데이터 보호

## 1. 서버 측 암호화

데이터 센터의 디스크에 저장하기 전에 객체를 암호화하고 객체를 다운로드할 때 이를 해독하도록 Amazon S3에 요청합니다.



1. Amazon S3 관리형 키를 사용한 서버 측 암호화(SSE-S3)

    Amazon S3 관리형 키를 사용한 서버 측 암호화(SSE-S3)를 사용하면 각 객체는 고유한 키로 암호화됩니다. 또한 추가 보안 조치로 주기적으로 바뀌는 마스터 키를 사용하여 키 자체를 암호화합니다. Amazon S3 서버 측 암호화는 가장 강력한 블록 암호 중 하나인 256비트 고급 암호화 표준(AES-256)을 사용하여 데이터를 암호화합니다.



2. AWS Key Management Service에 저장된 고객 마스터 키(CMK)를 사용한 서버 측 암호화(SSE-KMS)

   AWS Key Management Service에 저장된 고객 마스터 키(CMK)를 사용한 서버 측 암호화(SSE-KMS)는 SSE-S3와 유사하지만 이 서비스 사용 시 몇 가지 추가적인 이점이 있고 비용이 발생합니다. Amazon S3의 객체에 대한 무단 액세스에 대응하여 추가적인 보호를 제공하는 CMK를 사용하려면 별도의 권한이 필요합니다. SSE-KMS도 CMK가 사용된 때와 사용 주체를 표시하는 감사 추적 기능을 제공합니다. 또한 고객 관리형 CMK를 생성하고 관리하거나 사용자, 서비스 및 리전에 고유한 AWS 관리형 CMK를 사용할 수 있습니다. 자세한 내용은 AWS Key Management Service에 저장된 CMK를 사용한 서버 측 암호화(SSE-KMS)로 데이터 보호 단원을 참조하십시오.



3. 고객 제공 키를 사용한 서버 측 암호화(SSE-C)

   고객 제공 키를 사용한 서버 측 암호화(SSE-C)를 사용하면 사용자는 암호화 키를 관리하고 Amazon S3는 암호화(디스크에 쓸 때) 및 해독(객체에 액세스할 때)을 관리합니다.



## 2. 클라이언트 측 암호화

클라이언트 측 데이터를 암호화하여 암호화된 데이터를 Amazon S3에 업로드합니다. 이 경우 사용자가 암호화 프로세스, 암호화 키 및 관련 도구를 관리합니다.

-> 자기들이 준비해서 쓰면 클라이언트 측 암호화임



1. AWS Key Management Service(AWS KMS)에 저장된 고객 마스터 키(CMK)를 사용합니다.

\- 객체를 업로드할 때 — 고객 마스터 키(CMK) ID를 사용하여 클라이언트가 먼저 AWS KMS로 객체 데이터를 암호화하는 데 사용할 수 있는 CMK를 요청합니다. AWS KMS는 임의로 생성된 데이터 키의 다음 두 가지 버전을 반환합니다.

1-1. 클라이언트가 객체 데이터를 암호화하는 데 사용하는 일반 텍스트 버전의 데이터 키

1-2. 클라이언트가 Amazon S3에 객체 메타데이터로 업로드하는 동일한 데이터 키의 암호 BLOB



2. 애플리케이션 내에 저장한 마스터 키를 사용합니다.

클라이언트 측 마스터 키와 암호화되지 않은 데이터는 AWS로 전송되지 않습니다. 따라서 암호화 키를 안전하게 관리하는 것이 중요합니다. 해당 키를 잃어버리면 데이터의 암호를 해독할 수 없습니다



2-1. 객체를 업로드할 때Amazon S3 암호화 클라이언트에 클라이언트 측 마스터 키를 제공합니다. 클라이언트에서는 임의로 생성하는 데이터 암호화 키를 암호화하기 위해서만 이 마스터 키를 사용합니다. 프로세스는 다음과 같습니다.

2-1-1. Amazon S3 암호화 클라이언트에서 일회용 대칭 키(즉 데이터 암호화 키 또는 데이터 키)를 로컬로 생성합니다. 또한 데이터 키를 사용하여 단일 객체의 데이터를 암호화합니다. 클라이언트는 각 객체에 대한 개별 데이터 키를 생성합니다.

2-1-2. 클라이언트에서 사용자가 제공하는 마스터 키를 사용하여 데이터 암호화 키를 암호화합니다. 클라이언트에서 암호화된 데이터 키 및 해당 구성 요소 설명을 객체 메타데이터의 일부로 업로드합니다. 클라이언트는 구성 요소 설명을 사용하여 어떤 클라이언트 측 마스터 키를 암호화에 사용할지 결정합니다.

2-1-3. 그런 다음 클라이언트에서 기본적으로 암호화된 데이터를 Amazon S3로 업로드하고 암호화된 데이터 키를 객체 메타데이터(x-amz-meta-x-amz-key)로 Amazon S3에 저장합니다.



2-2. 객체를 다운로드할 때클라이언트가 먼저 Amazon S3에서 암호화된 객체를 다운로드합니다. 클라이언트에서 먼저 객체 메타데이터의 구성 요소 설명을 사용하여 데이터 키의 암호 해독에 어떤 마스터 키를 사용할지를 결정합니다. 클라이언트는 해당 마스터 키를 사용하여 데이터 키를 암호 해독하고 나서 데이터 키를 사용하여 객체를 암호 해독합니다.



---

# 네트워크

## ENA

Elastic Network Adapter
I/O 가상화로 고성능 I/O, 낮은 CPU 점유율로 좋은 네트워킹 제공

향상에 따른 추가요금 없음

Windows EC2 인스턴스에서 사용 가능

t3a.medium 지원



## EFA

Elastic Fabricdd Adapter

OS 바이패스 지원 안 함

Windows EC2 인스턴스에 연결은 가능하나 향상된 네트워킹 활성화 불가능

t3a.medium 지원 안 함



## Intel 82599 VF

Windows EC2 지원

t3a.medium 지원 안 함



## AWS ParallelCluster

오픈 소스 클러스터 관리 도구

HPC 클러스터를 배포 및 관리

더 높은 대역폭, 패킷 당 성능(PPS), 더 낮은 레이턴시와는 상관 없음. 이건 ENA, EFA의 특징.





---

# 배포

## Code Deploy

EC2, 온프레미스 인스턴스, 서버리스 lambda, ECS 로 배포 자동화하는 서비스

code, 서버리스 AWS Lambda 함수, 웹 파일, 패키지, 스크립트, 멀티미디어 등을 무제한 배포

서버에서 실행

S3 버킷, Github, Bitbucket 레포지토리에 저장된 애플리케이션을 배포할 수 있음



장점

새 기능을 신속하게 출시

Lambda 함수 업데이트

애플리케이션 다운타임 방지

인스턴스 수천 개를 쉽게 배포

지속적 관리





## CloudFormation 템플릿

 자체 인프라의 프로비저닝 및 관리를 세부적으로 제어할 수 있는 도구를 원하는 경우 CloudFormation을 사용 





## CodeCommit

개인 Git 레포지토리를 호스팅

모든 유형 저장

Git 기반 도구와 함께 사용



---



# 예산

## AWS Trusted Advisor

AWS Trusted Advisor는 AWS **모범 사례**에 따라 리소스를 프로비저닝하는 데 도움이 되도록 실시간 지침을 제공하는 온라인 도구 

비용 최적화, 성능, 보안, 내결함성, 서비스 한도 모범 권장 사항 제공



##  AWS Cost Optimization

 AWS Cost Optimization는 비용과 사용량을 보고, 분석 할 수 있는 도구 



##  Amazon Inspector 

 Amazon Inspector는 AWS에 배포된 애플리케이션의 보안 및 규정 준수를 개선하는데 도움이 되는 자동 보안 평가 서비스 



##  AWS 예산 

AWS 예산을 사용하면 비용 또는 사용량이 예산 금액을 초과하거나 초과할 것으로 예상될 때 알림을 받도록 사용자 지정 예산을 설정할 수 있습니다.





# 메세지

SQS(Simple Queue Service)

마이크로 서비스, 분산 시스템 및 서버리스 애플리케이션을 쉽게 분리하고 확장할 수 있도록 지원하는 완전관리형 메시지 대기열 서비스 

메시지 지향 미들웨어를 관리

복잡성과 오버헤드를 제거

개발자가 차별화 작업에 집중할 수 있도록 지원

다른 서비스를 가동할 필요 없이 소프트웨어 구성 요소 간에 어떤 볼륨의 메시지든 전송, 저장 및 수신 



짧은 폴링

서버의 하위 집합만 쿼리하여 응답에 포함할 수 있는 메시지를 찾습니다. Amazon SQS는 쿼리에서 메시지를 찾지 못하더라도 응답을 즉시 전송합니다. 



긴 폴링

모든 서버에서 메시지를 쿼리합니다. Amazon SQS는 적어도 하나의 사용 가능한 메시지를 수집한 후 요청에 지정된 최대 메시지 수까지 응답을 보냅니다. Amazon SQS는 폴링 대기 시간이 만료되는 경우에만 빈 응답을 보냅니다. 긴 폴링을 사용하면 Amazon SQS 대기열에서 메시지가 사용 가능해지는 즉시 간편하고 경제적인 방법으로 메시지를 검색할 수 있습니다. 긴 폴링을 사용하면 빈 응답을 수신하는 횟수를 줄일 수 있으므로 SQS 사용 비용을 절감할 수 있습니다. 거의 모든 경우 긴 폴링이 좋기는 한데, 즉각 응답이 필요한 경우는 수정 필요.



# 로드 밸런싱

## 연결 드레이닝

로드 밸런서가 요청을 중지, 취소중이거나 비정상인 요청을 완료하도록 하려면 연결 드레이닝

등록을 취소하기 전 연결 유지 시간 설정 가능

만약 Auto Scailing인 경우에는 진행 중인 요청이 완료되거나 최대 시간이 만료될 때 까지 대기

즉시 종료를 원하면 연결 드레이닝 비활성화



## 교차 영역 로드 밸런싱

 각각의 로드 밸런서 노드가 활성화된 **모든** 가용 영역에 있는 등록된 인스턴스 간에 요청을 균등하게 분산 

 차 영역 로드 밸런싱이 비활성화된 경우에는 각각의 로드 밸런서 노드가 **해당** 가용 영역에만 있는 등록된 인스턴스 간에 요청을 균등하게 분산 



## 고정 세션

 기본적으로 Classic Load Balancer는 로드가 가장 적은 등록 인스턴스에 각 요청을 독립적으로 라우팅 함.

 고정 세션 기능(세션 어피니티라고도 함)을 사용해 로드 밸런서가 사용자의 세션을 특정 인스턴스에 바인딩하도록 할 수 있습니다. 이렇게 하면 세션 중에 사용자로부터 들어오는 모든 요청이 동일한 인스턴스로 전송됩니다. 

 

## 유휴 연결 제한 시간

 유휴 제한 시간이 경과할 때까지 데이터가 전송되거나 전송 또는 수신되지 않으면 로드 밸런서는 프런트 엔드 연결을 종료 



# 데이터 베이스

## Aurora

속도, 안정성, 간편성, 비용 효율성이 뛰어난 관계형 데이터 베이스

MySQL 5배

PostgreSQL 3배

자동으로 장애 조치

Aurora Replica : 

#### Auroroa 장애 조치 case

1. 동일/다른 가용 영역에 정상aurora 복제본이 있으면 장애 조치시 DB 인스턴스의 cname이 정상 복제본을 가리키도록 함
2. aurora는 기본적으로 동일 가용 영역에 새 DB 인스턴스를 생성하려고 시도하고, 그럴 수 없는 경우 다른 가용 영역에 생성
3.  cname을 뒤집어 복제본 생성





# 인스턴스

## 구매 방법

1. 온디맨드

   - 실행하는 인스턴스에 따라 초당 성능에 대한 비용 지불
   - 갑작스럽고 예측할 수 없거나, 중단되어서는 안 되는 애플리케이션
   - 테스팅

2. savings plans

   - 온디맨드보다 최대 90% 저렴

3. 예약 인스턴스

   - 온디맨드보다 최대 75% 저렴
   - 1년 또는 3년 약정
   - 수요가 꾸준한
   - 예약 용량이 필요한

4. 스팟 인스턴스

   - 시작/종료시간 자유로운

   - 컴퓨팅 비용을 최소화 해야 하는
   - 긴급한 서버 성능 추가

5. 전용 호스팅

   - 고객 전용 물리 EC2
   - Windows server, SQL server, SUSE Linux Enterprise Server 등 라이센스 비용 절감



